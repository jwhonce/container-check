#!/usr/bin/env python

import errno
import sys

from checking.utils import Rpm, Selinux, log_error

# will be set to True on any failed confirm
error = False
FILES = []
try:
    rpm = Rpm('runc')
    rpm.verify()
    FILES = rpm.files
except OSError as e:
    log_error(e.strerror)
    if e.errno == errno.ENOENT:
        error = True

selinux = Selinux()
for path in FILES:
    try:
        # Side effect: The existance of the 'path' will also be verified
        selinux.verify(path)
    except OSError as e:
        log_error(e)
        error = True
        continue

sys.exit(0 if not error else 1)
